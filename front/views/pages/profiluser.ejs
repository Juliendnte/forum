<!DOCTYPE html>
<html lang="en">

<head>
    <title>CODER</title>
    <%- include('../components/head'); %>
</head>

<body>
<%- include('../components/Pop-up-Friend'); %>
<%- include('../components/Pop-up-Follower'); %>
<%- include('../components/header', {Name: Name}); %>
<section class="section-global">
    <%- include('../components/aside'); %>
    <section class="profil-user-global">
        <section class="info-user-global-ctn">
            <div class="img-user-global">
                <img src="<%= dataUser.utilisateur.Path %>" alt="img de profil">
            </div>
            <div class="info-user-global">
                <div class="info-user-name-email-date">
                    <div class="info-user-name-email">
                        <span><%= dataUser.utilisateur.Name %></span>
                        <span><%= dataUser.utilisateur.Email %></span>
                        <% if (Own) { %>
                            <% if (dataUser.utilisateur.Biography === null ) { %>
                                <div class="biographie-text">
                                    <p>Ajouter une biographie</p>
                                </div>
                            <% } else { %>
                                <div class="biographie-text">
                                    <span><%= dataUser.utilisateur.Biography %></span>
                                </div>
                            <% } %>
                        <% } else { %>
                            <% if (dataUser.utilisateur.Biography === null ) { %>
                                <div class="biographie-text">
                                    <p></p>
                                </div>
                            <% } else { %>
                                <div class="biographie-text">
                                    <span><%= dataUser.utilisateur.Biography %></span>
                                </div>
                            <% } %>
                        <% } %>
                    </div>
                    <div class="info-user-date">
                        <span>Membre depuis le : </span>
                        <span><%= dataUser.utilisateur.Create_at_formatted %></span>
                    </div>
                    <div class="info-user-tagsFav">
                        <div class="info-user-tagsFav">
                            <% if (dataUser.utilisateur.Tags && dataUser.utilisateur.Tags.length > 0) { %>
                                <% dataUser.utilisateur.Tags.forEach(function(tag) { %>
                                    <img src="<%= tag %>" alt="Tag Icon"/>
                                <% }); %>
                            <% } else { %>
                            <% } %>
                        </div>
                    </div>
                </div>
                <div class="info-user-follow-friend-global">
                    <div class="info-user-follow-friend">
                        <div class="info-user-follow">
                            <button class="btn-follow-friend" id="btnFollow">
                                <span><%= dataUser.utilisateur.Follow.length + dataUser.utilisateur.Friends.length %></span>
                                <span>followers</span>
                            </button>
                        </div>
                        <div class="info-user-friend">
                            <button class="btn-follow-friend" id="btnFriend">
                                <span><%= dataUser.utilisateur.Suivie.length + dataUser.utilisateur.Friends.length %></span>
                                <span>Suivi(e)s</span>
                            </button>
                        </div>
                    </div>
                    <div class="btn-follow-profil">
                        <% if (Own) { %>
                            <button>Modifier le profil</button>
                        <% } else { %>
                            <a href="/treatment/follow/<%= dataUser.utilisateur.Id %>">
                                <button>Suivre</button>
                            </a>
                        <% } %>
                    </div>
                </div>
            </div>
        </section>
        <section class="info-like-post-ctn">
            <div class="info-like-post-global">
                <div class="post-global">
                    <span><%= totalPosts %></span>
                    <span>Publications</span>
                </div>
                <div class="like-global">
                    <span><%= totalLikes %> </span>
                    <span>Votes</span>
                </div>
            </div>
        </section>
        <section class="info-user-biographie-ctn">
            <div class="nav-bar-user-global">
                <span class="nav-item select" id="vue-densemble">Vue d'ensembles</span>
                <span class="nav-item" id="postes">Publications</span>
                <span class="nav-item" id="commentaires">Commentaires</span>
            </div>
            <div class="content">
                <div class="vue-ensemble-btn" id="VueEnsembleCtn">
                    <% function timeAgo(date) {
                        const now = new Date();
                        const past = new Date(date);
                        const seconds = Math.floor((now - past) / 1000);

                        const intervals = {
                            annee: 31536000,
                            mois: 2592000,
                            semaine: 604800,
                            jour: 86400,
                            heure: 3600,
                            minute: 60,
                            seconde: 1
                        };

                        for (const key in intervals) {
                            const interval = intervals[key];
                            if (seconds >= interval) {
                                const count = Math.floor(seconds / interval);
                                switch (key) {
                                    case 'annee':
                                        return `il y a ${count} an${count > 1 ? 's' : ''}`;
                                    case 'mois':
                                        return `il y a ${count} mois`;
                                    case 'semaine':
                                        return `il y a ${count} semaine${count > 1 ? 's' : ''}`;
                                    case 'jour':
                                        return `il y a ${count} jour${count > 1 ? 's' : ''}`;
                                    case 'heure':
                                        return `il y a ${count} heure${count > 1 ? 's' : ''}`;
                                    case 'minute':
                                        return `il y a ${count} minute${count > 1 ? 's' : ''}`;
                                    case 'seconde':
                                        return `il y a ${count} seconde${count > 1 ? 's' : ''}`;
                                }
                            }
                        }
                        return 'à l\'instant';
                    } %>
                    <% if (dataUser.utilisateur.VueEnsemble && dataUser.utilisateur.VueEnsemble.length > 0) { %>
                        <% let hasPosts = false; %>
                        <% dataUser.utilisateur.VueEnsemble.forEach(function(item) { %>
                            <% if (item.Type === 'post') { %>
                                <%- include('../components/posts', { item: item, timeAgo: timeAgo }); %>
                            <% } else if (item.Type === 'message') { %>
                                <%- include('../components/messages', { item: item, timeAgo: timeAgo }); %>
                            <% } %>
                        <% }); %>
                        <% if (!hasPosts) { %>
                            <div class="err-ctn-profil-post">
                                <p>Aucune publication est disponible.</p>
                            </div>
                        <% } %>
                    <% } else { %>
                        <div class="err-ctn-profil-post">
                            <p>Aucune publication est disponible.</p>
                        </div>
                    <% } %>

                </div>
                <div class="posts" id="VuePostsCtn">
                    <% if (dataUser.utilisateur.VueEnsemble && dataUser.utilisateur.VueEnsemble.length > 0) { %>
                        <% let hasPosts = false; %>
                        <% dataUser.utilisateur.VueEnsemble.forEach(function(item) { %>
                            <% if (item.Type === 'post') { %>
                                <%- include('../components/posts', { item: item, timeAgo: timeAgo }); %>
                            <% } %>
                        <% }); %>

                        <% if (!hasPosts) { %>
                            <div class="err-ctn-profil-post">
                                <p>Aucune publication est disponible.</p>
                            </div>
                        <% } %>
                    <% } else { %>
                        <div class="err-ctn-profil-post">
                            <p>Aucune publication est disponible.</p>
                        </div>
                    <% } %>
                </div>
                <div class="message" id="VueMessageCtn">
                    <% if (dataUser.utilisateur.VueEnsemble && dataUser.utilisateur.VueEnsemble.length > 0) { %>
                        <% let hasMessages = false; %>
                        <% dataUser.utilisateur.VueEnsemble.forEach(function(item) { %>
                            <% if (item.Type === 'message') { %>
                                <% hasMessages = true; %>
                                <div class="post-profil">
                                    <div class="post-user-header">
                                        <div class="user-header-post-detail">
                                            <a href="/CODER/t/<%- item.TopicTitle %>">
                                                <div class="post-user-header-img">
                                                    <img src="<%= item.TopicPath %>" alt="image topic">
                                                </div>
                                                <div>
                                                    <span>t/<%= item.TopicTitle %></span>
                                                </div>
                                                <div>
                                                    <span>• Commenter <%= timeAgo(item.CreateAt) %></span>
                                                </div>
                                            </a>
                                        </div>
                                        <div class="user-header-post-btn">
                                            <button>
                                                Rejoindre
                                            </button>
                                            <button>
                                                <svg rpl="" fill="black" height="16"
                                                     icon-name="overflow-horizontal-fill" viewBox="0 0 20 20" width="16"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M6 10a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm6 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="post-user-content">
                                        <div class="post-user-content-title">
                                            <p><%= item.PostTitle %></p>
                                            <div class="post-user-content-description">
                                                <p><%= item.PostContent %></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="post-user-footer">
                                        <div class="post-user-footer-commente">
                                            <a href="/CODER/p/<%= item.PostId %>">
                                                <button>
                                                    <svg rpl="" aria-hidden="true" class="icon-comment"
                                                         fill="currentColor" height="20" icon-name="comment-outline"
                                                         viewBox="0 0 20 20" width="20"
                                                         xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M7.725 19.872a.718.718 0 0 1-.607-.328.725.725 0 0 1-.118-.397V16H3.625A2.63 2.63 0 0 1 1 13.375v-9.75A2.629 2.629 0 0 1 3.625 1h12.75A2.63 2.63 0 0 1 19 3.625v9.75A2.63 2.63 0 0 1 16.375 16h-4.161l-4 3.681a.725.725 0 0 1-.489.191ZM3.625 2.25A1.377 1.377 0 0 0 2.25 3.625v9.75a1.377 1.377 0 0 0 1.375 1.375h4a.625.625 0 0 1 .625.625v2.575l3.3-3.035a.628.628 0 0 1 .424-.165h4.4a1.377 1.377 0 0 0 1.375-1.375v-9.75a1.377 1.377 0 0 0-1.374-1.375H3.625Z"></path>
                                                    </svg>
                                                    <span><%= item.MessageCount %></span>
                                                </button>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                <div class="bar-suparator-post-profil"></div>
                            <% } %>
                        <% }); %>

                        <% if (!hasMessages) { %>
                            <div class="err-ctn-profil-post">
                                <p>Aucun commentaire disponible.</p>
                            </div>
                        <% } %>
                    <% } else { %>
                        <div class="err-ctn-profil-post">
                            <p>Aucun commentaire disponible.</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </section>
    </section>
</section>
</body>

</html>
